#!/bin/bash

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∫–æ–º–∞–Ω–¥–æ–π: bash fix-trading-bot.sh

echo "üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞"
echo "=============================================================="

# 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤..."
sudo apt update
sudo apt install -y dnsutils curl wget net-tools dos2unix

# 2. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º DNS –≤ WSL
echo "üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS..."
sudo bash -c 'cat > /etc/resolv.conf << EOF
nameserver 8.8.8.8
nameserver 1.1.1.1
EOF'

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
if [ ! -f "install-trading-bot-v5.1.sh" ]; then
    echo "‚ùå –°–∫—Ä–∏–ø—Ç install-trading-bot-v5.1.sh –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ"
    exit 1
fi

# 4. –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
cp install-trading-bot-v5.1.sh install-trading-bot-v5.1.sh.backup

# 5. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –∏–∑ Windows –≤ Linux
echo "üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞..."
dos2unix install-trading-bot-v5.1.sh

# 6. –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞
echo "üñß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP..."
sed -i '2i\# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ IP\nIP=$(ip route get 1 2>/dev/null | awk "{print \$NF;exit}" 2>/dev/null || hostname -I | awk "{print \$1}" 2>/dev/null || echo "127.0.0.1")\nexport IP\necho "üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω IP: $IP"\n' install-trading-bot-v5.1.sh

# 7. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º IP –∏–∑ DNS
echo "üîì –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è IP –∏–∑ DNS..."
sed -i 's/^#    IP=\$(/    IP=$(/' install-trading-bot-v5.1.sh

# 8. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å–Ω–æ–π IP –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å DNS
echo "üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Å–Ω–æ–≥–æ IP..."
sed -i '/IP=\$(dig/a\    if [ -z "$IP" ]; then IP="172.19.209.209"; fi' install-trading-bot-v5.1.sh

# 9. –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ..."
chmod +x install-trading-bot-v5.1.sh

echo "=============================================================="
echo "‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!"
echo ""
echo "üöÄ –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∫–æ–º–∞–Ω–¥–æ–π:"
echo "sudo ./install-trading-bot-v5.1.sh"
echo ""
echo "üìù –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–æ–º–µ–Ω–∞ –≤–≤–µ–¥–∏—Ç–µ: trading.local"
echo ""
